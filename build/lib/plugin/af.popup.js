(function($){"use strict";$.fn.popup=function(opts){return new popup(this[0],opts)};var queue=[],popup=function(containerEl,opts){typeof containerEl=="string"||containerEl instanceof String?this.container=document.getElementById(containerEl):this.container=containerEl;if(!this.container){window.alert("Error finding container for popup "+containerEl);return}try{if(typeof opts=="string"||typeof opts=="number")opts={message:opts,cancelOnly:"true",cancelText:"OK"};this.id=opts.id=opts.id||$.uuid(),this.addCssClass=opts.addCssClass?opts.addCssClass:"",this.suppressTitle=opts.suppressTitle||this.suppressTitle,this.title=opts.suppressTitle?"":opts.title||"Alert",this.message=opts.message||"",this.cancelText=opts.cancelText||"Cancel",this.cancelCallback=opts.cancelCallback||function(){},this.cancelClass=opts.cancelClass||"button",this.doneText=opts.doneText||"Done",this.doneCallback=opts.doneCallback||function(){},this.doneClass=opts.doneClass||"button",this.cancelOnly=opts.cancelOnly||!1,this.
onShow=opts.onShow||function(){},this.autoCloseDone=opts.autoCloseDone!==undefined?opts.autoCloseDone:!0,queue.push(this),queue.length===1&&this.show()}catch(e){console.log("error adding popup "+e)}};popup.prototype={id:null,addCssClass:null,title:null,message:null,cancelText:null,cancelCallback:null,cancelClass:null,doneText:null,doneCallback:null,doneClass:null,cancelOnly:!1,onShow:null,autoCloseDone:!0,suppressTitle:!1,show:function(){var self=this,markup="<div id='"+this.id+"' class='afPopup hidden "+this.addCssClass+"'>"+"<header>"+this.title+"</header>"+"<div>"+this.message+"</div>"+"<footer>"+"<a href='javascript:;' class='"+this.cancelClass+"' id='cancel'>"+this.cancelText+"</a>"+"<a href='javascript:;' class='"+this.doneClass+"' id='action'>"+this.doneText+"</a>"+"<div style='clear:both'></div>"+"</footer>"+"</div>",$el=$(markup);$(this.container).append($el),$el.bind("close",function(){self.hide()}),this.cancelOnly&&($el.find("A#action").hide(),$el.find("A#cancel").addClass("center"
)),$el.find("A").each(function(){var button=$(this);button.bind("click",function(e){button.attr("id")==="cancel"?(self.cancelCallback.call(self.cancelCallback,self),self.hide()):(self.doneCallback.call(self.doneCallback,self),self.autoCloseDone&&self.hide()),e.preventDefault()})}),self.positionPopup(),$.blockUI(.5),$el.bind("orientationchange",function(){self.positionPopup()}),$el.find("header").show(),$el.find("footer").show(),setTimeout(function(){$el.removeClass("hidden").addClass("show"),self.onShow(self)},50)},hide:function(){var self=this;$.query("#"+self.id).addClass("hidden"),$.unblockUI(),!$.os.ie&&!$.os.android?setTimeout(function(){self.remove()},250):self.remove()},remove:function(){var self=this,$el=$.query("#"+self.id);$el.unbind("close"),$el.find("BUTTON#action").unbind("click"),$el.find("BUTTON#cancel").unbind("click"),$el.unbind("orientationchange").remove(),queue.splice(0,1),queue.length>0&&queue[0].show()},positionPopup:function(){var popup=$.query("#"+this.id);popup.
css("top",window.innerHeight/2.5+window.pageYOffset-popup[0].clientHeight/2+"px"),popup.css("left",window.innerWidth/2-popup[0].clientWidth/2+"px")}};var uiBlocked=!1;$.blockUI=function(opacity){if(uiBlocked)return;opacity=opacity?" style='opacity:"+opacity+";'":"",$.query("BODY").prepend($("<div id='mask'"+opacity+"></div>")),$.query("BODY DIV#mask").bind("touchstart",function(e){e.preventDefault()}),$.query("BODY DIV#mask").bind("touchmove",function(e){e.preventDefault()}),uiBlocked=!0},$.unblockUI=function(){uiBlocked=!1,$.query("BODY DIV#mask").unbind("touchstart"),$.query("BODY DIV#mask").unbind("touchmove"),$("BODY DIV#mask").remove()},$.afui.registerDataDirective("[data-alert]",function(item){var $item=$(item),message=$item.attr("data-message");if(message.length===0)return;$(document.body).popup(message)}),$.afui.popup=function(opts){return $(document.body).popup(opts)}})(jQuery);